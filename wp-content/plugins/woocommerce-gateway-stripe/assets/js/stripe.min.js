function stripeFormHandler(){if(jQuery("#payment_method_stripe").is(":checked")&&(0==jQuery("input[name=stripe_customer_id]:checked").size()||"new"==jQuery("input[name=stripe_customer_id]:checked").val())&&0==jQuery("input.stripe_token").size()){var e=jQuery("#stripe-card-number").val(),r=jQuery("#stripe-card-cvc").val(),i=jQuery("#stripe-card-expiry").payment("cardExpiryVal"),s=jQuery("form.checkout, form#order_review");s.block({message:null,overlayCSS:{background:"#fff url("+woocommerce_params.ajax_loader_url+") no-repeat center",opacity:.6}});var a={number:e,cvc:r,exp_month:parseInt(i.month)||0,exp_year:parseInt(i.year)||0};return jQuery("#billing_first_name").size()>0?a.name=jQuery("#billing_first_name").val()+" "+jQuery("#billing_last_name").val():wc_stripe_params.billing_first_name&&(a.name=wc_stripe_params.billing_first_name+" "+wc_stripe_params.billing_last_name),jQuery("#billing_address_1").size()>0?(a.address_line1=jQuery("#billing_address_1").val(),a.address_line2=jQuery("#billing_address_2").val(),a.address_state=jQuery("#billing_state").val(),a.address_city=jQuery("#billing_city").val(),a.address_zip=jQuery("#billing_postcode").val(),a.address_country=jQuery("#billing_country").val()):a.address_line1&&(a.address_line1=wc_stripe_params.billing_address_1,a.address_line2=wc_stripe_params.billing_address_2,a.address_state=wc_stripe_params.billing_state,a.address_city=wc_stripe_params.billing_city,a.address_zip=wc_stripe_params.billing_postcode,a.address_country=wc_stripe_params.billing_country),Stripe.createToken(a,stripeResponseHandler),!1}return!0}function stripeResponseHandler(e,r){var i=jQuery("form.checkout, form#order_review");if(r.error)jQuery(".woocommerce_error, .woocommerce-error, .woocommerce-message, .woocommerce_message, .stripe_token").remove(),jQuery("#stripe-card-number").closest("p").before('<ul class="woocommerce_error woocommerce-error"><li>'+r.error.message+"</li></ul>"),notify("error",r.error.message,!0),i.unblock();else{var s=r.id;i.append("<input type='hidden' class='stripe_token' name='stripe_token' value='"+s+"'/>"),i.submit()}}Stripe.setPublishableKey(wc_stripe_params.key),jQuery(function(){jQuery("form.checkout").on("checkout_place_order_stripe",function(e){return stripeFormHandler()}),jQuery("form#order_review").submit(function(){return stripeFormHandler()}),jQuery("form.checkout, form#order_review").on("change","#stripe-card-number, #stripe-card-expiry, #stripe-card-cvc, input[name=stripe_customer_id]",function(e){jQuery(".woocommerce_error, .woocommerce-error, .woocommerce-message, .woocommerce_message, .stripe_token").remove(),jQuery(".stripe_token").remove()}),jQuery("form.checkout, form#order_review").on("change","input[name=stripe_customer_id]",function(){"new"==jQuery("input[name=stripe_customer_id]:checked").val()?jQuery("div.stripe_new_card").slideDown(200):jQuery("div.stripe_new_card").slideUp(200)})});